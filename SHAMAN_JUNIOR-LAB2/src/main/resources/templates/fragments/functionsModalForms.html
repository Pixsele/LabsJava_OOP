<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <style>
      body{
        font-family: Tahoma, sans-serif;
      }
      .modalAnother {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: #2e2e2e;
        border-radius: 30px;
        padding: 20px;
        border: 1px solid black;
        display: none;
        z-index: 1001;
        width: 380px;
        height: 450px;
      }

      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        display: none;
        z-index: 1000;
      }

      #modalSave {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: #1b40f8;
        padding: 20px;
        border: 1px solid #ccc;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        width: 400px;
        z-index: 1001;
      }
      #modalEdit {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: #1b40f8;
        padding: 20px;
        border: 1px solid #ccc;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        width: 400px;
        z-index: 1001;
      }

      #modalRemove {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: #2e2e2e;
        padding: 20px;
        border: none;
        border-radius: 25px;
        width: 400px;
        z-index: 1001;
      }

      #modal {
        display: none;
        transform: translate(-50%, -50%);
        background: #2e2e2e;
        padding: 20px;
        border: none;
        border-radius: 25px;
        width: 400px;
        height: auto;
        max-height: 60%;
        z-index: 1001;
        position: fixed;
        top: 50%;
        left: 50%;
        overflow-y: auto;
      }

      #closeButtomCreateFunction{
        text-align: center;
        float: right;
        margin-top: 5px;
        margin-right: 1px;
        margin-bottom: 10px;
        background-color: #ff66b3;
        color: white;
        font-family: Tahoma, sans-serif;
        font-weight: bold;
        font-size: 14px;
        border: none;
        border-radius: 25px;
        height: 35px;
        width: 130px;
        cursor: pointer;
        transition: background-color 0.3s ease;
      }

      #closeButtomCreateFunction:hover {
        background-color: #e45ba0;
      }

      #modalFunction {
        display: none;
        transform: translate(-50%, -50%);
        background: #2e2e2e;
        border: none;
        border-radius: 25px;
        padding: 15px 25px;
        width: 400px;
        min-height: 230px;
        max-height: 1500px;
        z-index: 1001;
        position: fixed;
        top: 50%;
        left: 50%;
      }

      #modalContentFunction{
        color: #ccff66;
        font-size: 17px;
      }

      #grinch table {
        width: 55%; /* Занимает всю ширину родительского контейнера */
        border-spacing: 0; /* Убирает двойные линии между ячейками */
        font-family: Tahoma, sans-serif;
        margin: 0;
        overflow: hidden;
        border: none;
      }

      #grinch th, #grinch td {
        padding: 10px; /* Внутренние отступы */
        text-align: center; /* Текст по левому краю */
        border: 1px solid #e0e0e0; /* Светло-серая рамка */
      }

      #grinch th {
        background-color: #ccff66; /* Фон заголовка таблицы — розовый */
        color: #2e2e2e; /* Белый текст в заголовке */
        font-weight: bold; /* Жирный текст */
      }

      #grinch tr:nth-child(even) {
        background-color: #f2f2f2; /* Серый фон для четных строк */
      }

      #grinch tr:nth-child(odd) {
        background-color: #fff; /* Белый фон для нечетных строк */
      }

      #grinch td:first-child {
        text-align: center; /* Центровка первой колонки */
      }

      #grinch table tr:hover {
        background-color: #dbfb96; /* Слегка розовый цвет при наведении на строку */
      }

      #grinch thead th:first-child {
        border-top-left-radius: 25px; /* Левый верхний угол */
      }
      #grinch thead th:last-child {
        border-top-right-radius: 25px; /* Правый верхний угол */
      }
      #grinch tbody tr:last-child td:first-child {
        border-bottom-left-radius: 25px; /* Левый нижний угол */
      }
      #grinch tbody tr:last-child td:last-child {
        border-bottom-right-radius: 25px; /* Правый нижний угол */
      }

      #loadButton{
        background-color: #ccff66;
        color: #2e2e2e;
        border: none;
        border-radius: 25px;
        width: 130px;
        height: 40px;
        text-align: center;
        margin-bottom: 15px;
        margin-top: 10px;
        float: left;
        font-size: 15px;
        font-family: Tahoma, sans-serif;
        font-weight: bold;
      }

      #closeclose{
        background-color: #ff66b3;
        color: #ffffff;
        border: none;
        border-radius: 25px;
        width: 130px;
        height: 40px;
        text-align: center;
        margin-bottom: 15px;
        margin-top: 10px;
        float: right;
        font-size: 15px;
        font-family: Tahoma, sans-serif;
        font-weight: bold;
      }
    </style>
</head>
<body>

<div id="modalFunction">
  <div id="modalContentFunction">
    <h3>Выберите функцию</h3>
    <table border="1" width="100%">
      <thead id="grinch">
      <tr>
        <th>ID</th>
        <th>Имя функции</th>
      </tr>
      </thead>
      <tbody>
      <tr th:each="function : ${functions}" class="function-row"
          th:onclick="|selectFunction(this, '${function.id}', modalTarget)|">
        <td th:text="${function.getId()}"></td>
        <td th:text="${function.getName()}"></td>
      </tr>
      </tbody>
    </table>
    <button id="loadButton" onclick="loadFunction()">Загрузить</button>
    <button id="closeclose" onclick="closeFunctionList()">Закрыть</button>
  </div>
</div>

<div id="modal">
  <div id="modalContent"></div>
</div>

<div id="modalSave">
  <div id="modalContentSave">
    <form onsubmit="saveFunction(event)">
      <label for="funcName">Название функции:</label>
      <input type="text" name="funcName" id="funcName" required>
      <button type="submit">Cохранить</button>
    </form>

    <!-- Кнопка для открытия диалога выбора файла -->
    <input type="file" id="fileInput" />
    <button id="uploadBtn">Загрузить файл</button>

    <script>
      // Слушаем клик по кнопке и отправляем файл на сервер
      document.getElementById('uploadBtn').addEventListener('click', function() {
        // Получаем выбранный файл
        const fileInput = document.getElementById('fileInput');
        const file = fileInput.files[0];  // Берем первый выбранный файл

        if (file) {
          // Создаем объект FormData, чтобы отправить файл на сервер
          const formData = new FormData();
          formData.append('file', file);

          // Отправляем файл на сервер
          fetch('/functions/save', {
            method: 'POST',
            body: formData
          })
                  .then(response => response.json())
                  .then(data => {
                    alert('Файл загружен успешно!');
                  })
                  .catch(error => {
                    alert('Ошибка загрузки файла: ' + error);
                  });
        } else {
          alert('Пожалуйста, выберите файл для загрузки.');
        }
      });
    </script>

  </div>
  <button onclick="closeSave()">Закрыть</button>
</div>

<div id="modalAnother" class="modalAnother">
  <div id="modalContentAnother">
  </div>
</div>

<div id="modalEdit">
  <div id="modalEditContent">
    <form onsubmit="editFunc(event)">
      <label for="xValue">Какую точку изменить:</label>
      <input type="number" name="xValue" id="xValue" required>
      <label for="yValue">На что изменить</label>
      <input type="number" name="yValue" id="yValue" required>
      <button type="submit">Cохранить</button>
    </form>
  </div>
  <button onclick="closeEdit()">Закрыть</button>
</div>

<div id="modalRemove">
  <div id="modalRemoveContent">
    <form onsubmit="removeFunc(event)">
      <label for="xToRemove">Какую точку изменить:</label>
      <input type="number" name="xValue" id="xToRemove" required>
      <button type="submit">Cохранить</button>
    </form>
  </div>
  <button onclick="closeRemove()">Закрыть</button>
</div>

<div id="modalOverlay" class="modal-overlay"></div>

<div th:if="${showError}">
  <div th:replace="fragments/errorForm"></div>
  <script>
    document.getElementById('errorForm').style.display = 'block';
  </script>
</div>

<div th:replace="fragments/errorForm"></div>
</body>
</html>